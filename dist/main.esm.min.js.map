{"version":3,"file":"main.esm.min.js","sources":["../src/core/utils.ts","../src/core/index.ts","../src/core/polyfill.ts","../src/index.ts"],"sourcesContent":["// 生成唯一的值\nlet uid = 0;\nconst symbolPolyfill = function(prefix = \"__special\"): string {\n  return `${prefix}${uid++}`;\n};\n// 将对象拼接成字符串\nconst splicingParams = function(o: Object): string {\n  let text = \"\";\n  o = o || {};\n  for (const name in o) {\n    if (o.hasOwnProperty(name)) {\n      const value = o[name];\n      text += `${name}=${value}&`;\n    }\n  }\n  // 给第一个字符添加?同时去掉最后一个&\n  if (text.length) {\n    text = `?${text.slice(0, -1)}`;\n  }\n  return text;\n};\n// 解析url的params\nconst analysisParams = function(url: string) {\n  const index = url.indexOf(\"?\") + 1;\n  const o: {\n    [propName: string]: any;\n  } = {};\n  if (!index) {\n    return {\n      url,\n      params: o\n    };\n  }\n  const u = url.slice(index);\n  const arr = u.split(\"&\");\n  for (let item of arr) {\n    const [name, value] = item.split(\"=\");\n    o[name] = value;\n  }\n  return { url: url.slice(0, index - 1), params: o };\n};\nexport { symbolPolyfill, splicingParams, analysisParams };\n","import { symbolPolyfill, splicingParams, analysisParams } from \"./utils\";\ndeclare global {\n  interface Window {\n    [props: string]: any;\n  }\n  interface Object {\n    [props: string]: any;\n  }\n}\ninterface Ioptions {\n  params?: Object;\n  timeout?: number;\n  name?: string;\n  prefix?: string;\n}\ntype callback = (type: Error, data: any) => void;\nconst getName = function getName(prefix: string) {\n  let name = symbolPolyfill(prefix);\n  while (window[name]) {\n    name = symbolPolyfill(prefix);\n  }\n  return name;\n};\nconst jsonp = function jsonp(\n  this: any,\n  url: string,\n  option?: Ioptions,\n  fn?: callback\n) {\n  let { params: par, url: urls } = analysisParams(url);\n  url = urls;\n  // 交换一下参数\n  if (!option) {\n    option = {};\n  }\n  if (typeof option === \"function\") {\n    fn = option;\n    option = {};\n  }\n  const { name = \"callback\", timeout = 10000, params = {}, prefix } = option;\n  const id = getName(prefix);\n  // 如果成功给回调函数传递值\n  window[id] = (data: any) => {\n    clear();\n    if (typeof fn !== \"function\") {\n      return;\n    }\n    fn.call(this, null, data);\n  };\n  params[name] = id;\n  par = Object.assign(par, params);\n  let timer: NodeJS.Timeout;\n  if (typeof timeout === \"number\") {\n    timer = setTimeout(() => {\n      clear();\n      if (typeof fn !== \"function\") {\n        return;\n      }\n      fn.call(this, new Error(`Task timeout`));\n    }, timeout);\n  }\n  const script = document.createElement(\"script\");\n  const href = encodeURI(`${url}${splicingParams(par)}`);\n\n  script.src = href;\n  script.onerror = () => {\n    clear();\n    if (typeof fn !== \"function\") {\n      return;\n    }\n    fn.call(\n      this,\n      new Error(`Failed to create jsonp, request target address is:${url}`)\n    );\n  };\n  document.body.appendChild(script);\n  // 取消函数\n  function clear() {\n    if (script.parentElement) {\n      script.parentElement.removeChild(script);\n    }\n    if (timer) {\n      clearTimeout(timer);\n    }\n    // 防止多次执行\n    window[id] = () => {};\n  }\n  return clear;\n};\nexport { Ioptions, callback };\nexport default jsonp;\n","if (typeof Object.assign != \"function\") {\n  Object.assign = function assign(target: any, varArgs: any) {\n    // .length of function is 2\n    \"use strict\";\n    if (target == null) {\n      // TypeError if undefined or null\n      throw new TypeError(\"Cannot convert undefined or null to object\");\n    }\n\n    let to = Object(target);\n\n    for (var index = 1; index < arguments.length; index++) {\n      var nextSource = arguments[index];\n\n      if (nextSource != null) {\n        // Skip over if undefined or null\n        for (let nextKey in nextSource) {\n          // Avoid bugs when hasOwnProperty is shadowed\n          if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n            to[nextKey] = nextSource[nextKey];\n          }\n        }\n      }\n    }\n    return to;\n  };\n}\n","import index from \"./core/index\";\nimport \"./core/polyfill\";\nimport { Ioptions } from \"./core/index\";\n\n// 代理一下\nconst jsonp = function(url: string, option?: Ioptions) {\n  let cancel: Function;\n  const promise = new Promise((resolve, reject) => {\n    cancel = index(url, option, (err, data) => {\n      if (err) {\n        return reject(err);\n      }\n      return resolve(data);\n    });\n  });\n  return {\n    cancel,\n    promise\n  };\n};\n\nexport default jsonp;\nexport { index as callback, jsonp as get };\n"],"names":["uid","symbolPolyfill","prefix","jsonp","url","option","fn","_a","index","indexOf","o","params","arr_1","slice","split","_i","name_2","value","par","urls","timer","_b","name","_c","timeout","_d","id","window","getName","data","clear","call","_this","Object","assign","setTimeout","Error","script","document","createElement","href","encodeURI","text","name_1","hasOwnProperty","length","splicingParams","parentElement","removeChild","clearTimeout","src","onerror","body","appendChild","target","varArgs","TypeError","to","arguments","nextSource","nextKey","prototype","cancel","promise","Promise","resolve","reject","err"],"mappings":"AACA,IAAIA,EAAM,EACJC,EAAiB,SAASC,GAC9B,oBAD8BA,eACvB,GAAGA,EAASF,KCoBfG,EAAQ,SAEZC,EACAC,EACAC,GAJY,WAMRC,EDPiB,SAASH,GAC9B,IAAMI,EAAQJ,EAAIK,QAAQ,KAAO,EAC3BC,EAEF,GACJ,IAAKF,EACH,MAAO,CACLJ,MACAO,OAAQD,GAKZ,IAFA,QAEiBE,EAFPR,EAAIS,MAAML,GACNM,MAAM,KACHC,WAAAA,IAAK,CAAjB,IACGR,kBAACS,OAAMC,OACbP,EAAEM,GAAQC,EAEZ,MAAO,CAAEb,IAAKA,EAAIS,MAAM,EAAGL,EAAQ,GAAIG,OAAQD,OCVzCQ,WAAaC,QACnBf,EAAMe,EAEDd,IACHA,EAAS,IAEW,mBAAXA,IACTC,EAAKD,EACLA,EAAS,IAEH,IAYJe,EAZIC,SAAAC,0BAAmBC,YAAAC,mBAAiBC,WAAAd,kBACtCe,EAxBQ,SAAiBxB,GAE/B,IADA,IAAIoB,EAAOrB,EAAeC,GACnByB,OAAOL,IACZA,EAAOrB,EAAeC,GAExB,OAAOoB,EAmBIM,WAEXD,OAAOD,GAAM,SAACG,GACZC,IACkB,mBAAPxB,GAGXA,EAAGyB,KAAKC,EAAM,KAAMH,IAEtBlB,EAAOW,GAAQI,EACfR,EAAMe,OAAOC,OAAOhB,EAAKP,GAEF,iBAAZa,IACTJ,EAAQe,YAAW,WACjBL,IACkB,mBAAPxB,GAGXA,EAAGyB,KAAKC,EAAM,IAAII,MAAM,mBACvBZ,IAEL,IAAMa,EAASC,SAASC,cAAc,UAChCC,EAAOC,UAAU,GAAGrC,EDxDL,SAASM,GAC9B,IAAIgC,EAAO,GAEX,IAAK,IAAMC,KADXjC,EAAIA,GAAK,GACa,CACpB,GAAIA,EAAEkC,eAAeD,GAEnBD,GAAWC,MADGjC,EAAEiC,OAQpB,OAHID,EAAKG,SACPH,EAAO,IAAIA,EAAK7B,MAAM,GAAI,IAErB6B,EC2CyBI,CAAe5B,IAe/C,SAASY,IACHO,EAAOU,eACTV,EAAOU,cAAcC,YAAYX,GAE/BjB,GACF6B,aAAa7B,GAGfO,OAAOD,GAAM,aAEf,OAvBAW,EAAOa,IAAMV,EACbH,EAAOc,QAAU,WACfrB,IACkB,mBAAPxB,GAGXA,EAAGyB,KACDC,EACA,IAAII,MAAM,qDAAqDhC,KAGnEkC,SAASc,KAAKC,YAAYhB,GAYnBP,GCvFmB,mBAAjBG,OAAOC,SAChBD,OAAOC,OAAS,SAAgBoB,EAAaC,GAG3C,GAAc,MAAVD,EAEF,MAAM,IAAIE,UAAU,8CAKtB,IAFA,IAAIC,EAAKxB,OAAOqB,GAEP9C,EAAQ,EAAGA,EAAQkD,UAAUb,OAAQrC,IAAS,CACrD,IAAImD,EAAaD,UAAUlD,GAE3B,GAAkB,MAAdmD,EAEF,IAAK,IAAIC,KAAWD,EAEd1B,OAAO4B,UAAUjB,eAAeb,KAAK4B,EAAYC,KACnDH,EAAGG,GAAWD,EAAWC,IAKjC,OAAOH,QCnBLtD,EAAQ,SAASC,EAAaC,GAClC,IAAIyD,EACEC,EAAU,IAAIC,SAAQ,SAACC,EAASC,GACpCJ,EAAStD,EAAMJ,EAAKC,GAAQ,SAAC8D,EAAKtC,GAChC,OAAIsC,EACKD,EAAOC,GAETF,EAAQpC,SAGnB,MAAO,CACLiC,SACAC"}